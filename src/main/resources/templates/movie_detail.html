<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title th:text="${movie.title}">ì˜í™” ìƒì„¸ì •ë³´</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
            margin: 0 auto;
            padding: 20px;
            max-width: 900px;
            color: #111;
        }

        h1, h2 {
            color: #222;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }

        .poster img, video {
            width: 100%;
            max-width: 400px;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        .section {
            background-color: #fff;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .review-item {
            display: flex;
            flex-direction: column;
            border-bottom: 1px solid #ddd;
            padding: 10px 0;
        }

        .review-content {
            margin-bottom: 10px;
        }

        .actions {
            display: flex;
            gap: 6px;
        }

        .actions button, .actions a, .section button {
            background-color: #333;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 13px;
            text-decoration: none;
        }

        .actions button:hover, .section button:hover, .actions a:hover {
            background-color: #555;
        }

        .danger {
            background-color: #c00 !important;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 14px;
        }

        .back a {
            display: inline-block;
            text-align: center;
            background-color: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
        }
    </style>
</head>
<body>

<h1 th:text="${movie.title}">ì˜í™” ì œëª©</h1>

<div class="section poster" style="text-align:center;">
    <img th:src="@{${movie.imageUrl}}" alt="í¬ìŠ¤í„°" onerror="this.src='/images/placeholder.jpg'" />
</div>

<div class="section video-container" style="text-align:center;">
    <video controls>
        <source th:src="@{${movie.videoUrl}}" type="video/mp4" />
        ë¸Œë¼ìš°ì €ê°€ video íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </video>
</div>

<!-- ğŸ§ ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ -->
<div class="section audio-container" th:if="${movie.audioUrl != null}" style="text-align:center;">
    <h2>ğŸ§ ëŒ€í‘œ ìŒì•…</h2>
    <audio controls>
        <source th:src="@{${movie.audioUrl}}" type="audio/mpeg" />
        ë¸Œë¼ìš°ì €ê°€ audio íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </audio>
</div>

<div class="section description">
    <p th:text="${movie.description}">ì˜í™” ì„¤ëª…</p>
</div>

<!-- ë¦¬ë·° ëª©ë¡ -->
<div class="section reviews">
    <h2>ë¦¬ë·° ëª©ë¡</h2>
    <div th:each="review : ${reviews}" class="review-item">
        <div th:id="'view-' + ${review.id}" class="review-content" th:text="${review.content}"></div>

        <form th:id="'edit-form-' + ${review.id}" th:action="@{/reviews/edit}" method="post" style="display:none;">
            <input type="hidden" name="reviewId" th:value="${review.id}" />
            <textarea name="content" rows="2" required th:text="${review.content}"></textarea>
            <div class="actions" style="margin-top: 8px;">
                <button type="submit">ìˆ˜ì • ì™„ë£Œ</button>
                <button type="button" th:onclick="'cancelEdit(' + ${review.id} + ')'">ì·¨ì†Œ</button>
            </div>
        </form>

        <div class="actions" th:id="'buttons-' + ${review.id}">
            <form th:action="@{/reviews/like}" method="post">
                <input type="hidden" name="reviewId" th:value="${review.id}" />
                <button type="submit">â¤ï¸ <span th:text="${review.likeCount}">0</span></button>
            </form>
            <form th:if="${session.user?.id == review.author.id}" th:action="@{/reviews/delete}" method="post">
                <input type="hidden" name="reviewId" th:value="${review.id}" />
                <button type="submit" class="danger">ì‚­ì œ</button>
            </form>
            <button type="button" th:if="${session.user?.id == review.author.id}" th:onclick="'editReview(' + ${review.id} + ')'">ìˆ˜ì •</button>
        </div>
    </div>
</div>

<!-- ë¦¬ë·° ì‘ì„± -->
<div class="section review-form">
    <h2>ë¦¬ë·° ì‘ì„±</h2>
    <form th:action="@{/reviews/add}" method="post">
        <input type="hidden" name="movieId" th:value="${movie.id}" />
        <textarea name="content" rows="3" placeholder="ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”" required></textarea>
        <button type="submit">ë¦¬ë·° ë“±ë¡</button>
    </form>
</div>

<div class="back" style="margin-top: 40px;">
    <a th:href="@{/}">â† í™ˆìœ¼ë¡œ</a>
</div>

<script>
    function editReview(id) {
        document.getElementById('view-' + id).style.display = 'none';
        document.getElementById('edit-form-' + id).style.display = 'block';
        document.getElementById('buttons-' + id).style.display = 'none';
    }

    function cancelEdit(id) {
        document.getElementById('view-' + id).style.display = 'block';
        document.getElementById('edit-form-' + id).style.display = 'none';
        document.getElementById('buttons-' + id).style.display = 'flex';
    }
</script>

</body>
</html>